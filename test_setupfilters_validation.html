<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SetupFilters Validation Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-result { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .pass { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .fail { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    </style>
</head>
<body>
    <h1>Executive Dashboard setupFilters Function Validation</h1>
    <div id="test-results"></div>

    <script>
        const results = document.getElementById('test-results');
        
        function addResult(message, type) {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.textContent = message;
            results.appendChild(div);
        }

        async function runTests() {
            addResult('Starting validation tests...', 'info');

            // Test 1: Check if executive_dashboard.js loads without syntax errors
            try {
                const response = await fetch('/executive_dashboard.js');
                const jsContent = await response.text();
                
                if (jsContent.includes('function setupFilters()')) {
                    addResult('✓ setupFilters function definition found', 'pass');
                } else {
                    addResult('✗ setupFilters function definition NOT found', 'fail');
                }

                if (jsContent.includes('setupFilters();')) {
                    addResult('✓ setupFilters function call found', 'pass');
                } else {
                    addResult('✗ setupFilters function call NOT found', 'fail');
                }

                // Test for regex pattern fix
                const regexPattern = /\/\[\\s\\._\\-@\]\+\//g;
                const regexMatches = jsContent.match(regexPattern);
                if (regexMatches && regexMatches.length > 0) {
                    addResult(`✓ Fixed regex pattern found (${regexMatches.length} instances)`, 'pass');
                } else {
                    addResult('? Regex pattern validation - may need verification', 'info');
                }

                addResult('✓ JavaScript file loads successfully', 'pass');
            } catch (error) {
                addResult(`✗ Error loading JavaScript file: ${error.message}`, 'fail');
            }

            // Test 2: Check server availability
            try {
                const healthResponse = await fetch('/api/health');
                if (healthResponse.ok) {
                    const healthData = await healthResponse.json();
                    addResult(`✓ Server is healthy: ${healthData.status}`, 'pass');
                } else {
                    addResult('! Server health check returned non-OK status', 'info');
                }
            } catch (error) {
                addResult(`? Server health check failed: ${error.message}`, 'info');
            }

            // Test 3: Check HTML structure
            try {
                const htmlResponse = await fetch('/executive_dashboard.html');
                const htmlContent = await htmlResponse.text();
                
                const requiredElements = ['solutionFilter', 'accountMgrFilter', 'clearFilters'];
                let foundElements = 0;
                
                requiredElements.forEach(elementId => {
                    if (htmlContent.includes(`id="${elementId}"`)) {
                        foundElements++;
                        addResult(`✓ Filter element found: ${elementId}`, 'pass');
                    } else {
                        addResult(`✗ Filter element missing: ${elementId}`, 'fail');
                    }
                });

                if (foundElements === requiredElements.length) {
                    addResult('✓ All required filter elements present', 'pass');
                } else {
                    addResult(`✗ Missing ${requiredElements.length - foundElements} required filter elements`, 'fail');
                }

            } catch (error) {
                addResult(`✗ Error checking HTML structure: ${error.message}`, 'fail');
            }

            addResult('Validation tests completed!', 'info');
        }

        // Run tests when page loads
        runTests();
    </script>
</body>
</html>
