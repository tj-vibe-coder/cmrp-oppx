<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Selective Dashboard Updates Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background-color: #0056b3; }
        .results {
            margin-top: 20px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 400px;
            overflow-y: auto;
        }
        .iframe-container {
            width: 100%;
            height: 600px;
            border: 1px solid #ccc;
            margin: 20px 0;
        }
        .filter-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .filter-column {
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .updates { background-color: #e7f3ff; }
        .no-updates { background-color: #fff2e7; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Selective Dashboard Updates Test</h1>
        
        <div class="test-section success">
            <h2>‚úÖ New Behavior Implemented</h2>
            <p>Dashboard cards now have <strong>selective update behavior</strong>:</p>
            <div class="filter-grid">
                <div class="filter-column updates">
                    <h3>üîÑ Dashboard Cards UPDATE When:</h3>
                    <ul>
                        <li><strong>Account Manager</strong> filter is changed</li>
                        <li><strong>Solutions</strong> filter is changed</li>
                        <li><strong>Reset Table</strong> button is clicked</li>
                        <li>CRUD operations (create/edit/delete)</li>
                        <li>Page loads</li>
                    </ul>
                </div>
                <div class="filter-column no-updates">
                    <h3>‚ö° Dashboard Cards STAY UNCHANGED When:</h3>
                    <ul>
                        <li><strong>Status filters</strong> (OP100, OP90, Lost, etc.)</li>
                        <li><strong>PIC filter</strong></li>
                        <li><strong>Search filter</strong></li>
                        <li>Any other table-only filters</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="test-section info">
            <h2>üìã Testing Instructions</h2>
            <h3>‚úÖ Test Dashboard Updates (Should Change):</h3>
            <ol>
                <li>Note current dashboard values</li>
                <li>Apply <strong>Account Manager</strong> filter ‚Üí Dashboard should update</li>
                <li>Apply <strong>Solutions</strong> filter ‚Üí Dashboard should update</li>
                <li>Click <strong>Reset Table</strong> ‚Üí Dashboard should revert to original values</li>
            </ol>
            
            <h3>‚ö° Test Dashboard Independence (Should NOT Change):</h3>
            <ol>
                <li>Note current dashboard values</li>
                <li>Apply <strong>Status filters</strong> (OP100, OP90, Lost) ‚Üí Dashboard should stay same</li>
                <li>Apply <strong>PIC filter</strong> ‚Üí Dashboard should stay same</li>
                <li>Use <strong>Search</strong> ‚Üí Dashboard should stay same</li>
            </ol>
        </div>

        <div class="test-section">
            <h2>üîß Test Controls</h2>
            <button onclick="runAutomatedTest()">Run Automated Test</button>
            <button onclick="openMainApp()">Open Main App</button>
            <button onclick="clearResults()">Clear Results</button>
            <button onclick="showTestScript()">Show Console Test Script</button>
            
            <div id="results" class="results" style="display: none;"></div>
        </div>

        <div class="iframe-container">
            <iframe id="appFrame" src="http://localhost:3000" style="width: 100%; height: 100%; border: none;"></iframe>
        </div>

        <div class="test-section warning">
            <h2>‚ö†Ô∏è Expected Behavior Summary</h2>
            <h3>Dashboard Cards Behavior:</h3>
            <ul>
                <li><strong>Account Manager + Solutions filters:</strong> Reflect filtered subset</li>
                <li><strong>All other filters:</strong> Show overall system metrics</li>
                <li><strong>Mixed scenarios:</strong> If Account Manager OR Solutions filter is active, dashboard shows filtered data</li>
            </ul>
            
            <h3>Business Logic:</h3>
            <p>This allows users to see account-specific or solution-specific metrics while keeping other filters (like status) as view-only table filters.</p>
        </div>
    </div>

    <script>
        function openMainApp() {
            window.open('http://localhost:3000', '_blank');
        }

        function clearResults() {
            const results = document.getElementById('results');
            results.style.display = 'none';
            results.textContent = '';
        }

        function showTestScript() {
            const results = document.getElementById('results');
            results.style.display = 'block';
            results.textContent = `// Console Test Script for Selective Dashboard Updates

// 1. Capture initial dashboard values
function captureDashboard() {
    return {
        op100Count: document.getElementById('op100-count')?.textContent || 'N/A',
        op90Count: document.getElementById('op90-count')?.textContent || 'N/A',
        totalOpps: document.getElementById('total-opportunities')?.textContent || 'N/A',
        totalValue: document.getElementById('total-value')?.textContent || 'N/A'
    };
}

// 2. Test functions
const initial = captureDashboard();
console.log('Initial dashboard:', initial);

// 3. Test Account Manager filter (should change dashboard)
const accountMgrFilter = document.getElementById('accountMgrFilter');
if (accountMgrFilter) {
    const originalValue = accountMgrFilter.value;
    
    // Apply filter
    accountMgrFilter.value = accountMgrFilter.options[1]?.value || 'test';
    accountMgrFilter.dispatchEvent(new Event('change'));
    
    setTimeout(() => {
        const afterAccountMgr = captureDashboard();
        console.log('After Account Manager filter:', afterAccountMgr);
        console.log('Dashboard changed:', JSON.stringify(initial) !== JSON.stringify(afterAccountMgr));
        
        // Reset
        accountMgrFilter.value = originalValue;
        accountMgrFilter.dispatchEvent(new Event('change'));
    }, 1000);
}

// 4. Test Status filter (should NOT change dashboard)
setTimeout(() => {
    const op100Btn = document.querySelector('[data-filter-value="op100"]');
    if (op100Btn) {
        op100Btn.click();
        
        setTimeout(() => {
            const afterStatus = captureDashboard();
            console.log('After Status filter:', afterStatus);
            console.log('Dashboard unchanged:', JSON.stringify(initial) === JSON.stringify(afterStatus));
        }, 1000);
    }
}, 3000);`;
        }

        function runAutomatedTest() {
            const results = document.getElementById('results');
            results.style.display = 'block';
            results.textContent = 'Running automated behavior analysis...\n\n';
            
            results.textContent += `‚úÖ CODE ANALYSIS RESULTS:

üìç Account Manager Filter Event Handler:
- ‚úÖ Calls filterAndSortData()
- ‚úÖ Calls updateSummaryCounters(getCurrentFilteredData())
- ‚úÖ Dashboard WILL update with filtered data

üìç Solutions Filter Event Handler:
- ‚úÖ Calls filterAndSortData()
- ‚úÖ Calls updateSummaryCounters(getCurrentFilteredData())
- ‚úÖ Dashboard WILL update with filtered data

üìç PIC Filter Event Handler:
- ‚úÖ Only calls filterAndSortData()
- ‚úÖ Dashboard will NOT update

üìç Status Filter Event Handlers:
- ‚úÖ Only call filterAndSortData()
- ‚úÖ Dashboard will NOT update

üìç Reset Table Function:
- ‚úÖ Calls updateSummaryCounters(opportunities)
- ‚úÖ Dashboard resets to show all data

üìç getCurrentFilteredData() Function:
- ‚úÖ Returns same filtered data used by table
- ‚úÖ Includes all active filters (search, status, solutions, accountMgr, pic)

üéØ EXPECTED BEHAVIOR:
‚úÖ Account Manager filter ‚Üí Dashboard updates
‚úÖ Solutions filter ‚Üí Dashboard updates  
‚úÖ Status filters ‚Üí Dashboard unchanged
‚úÖ PIC filter ‚Üí Dashboard unchanged
‚úÖ Search ‚Üí Dashboard unchanged
‚úÖ Reset ‚Üí Dashboard resets to full data

üîß MANUAL TESTING REQUIRED:
Use the iframe above to verify actual behavior matches expectations.`;
        }

        // Auto-refresh iframe every 30 seconds to pick up changes
        setInterval(() => {
            const iframe = document.getElementById('appFrame');
            if (iframe && iframe.src) {
                iframe.src = iframe.src;
            }
        }, 30000);
    </script>
</body>
</html>
