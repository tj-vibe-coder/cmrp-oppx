<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logout Consistency Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            width: 100%;
        }
        
        h1 {
            color: #333;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .test-section {
            margin-bottom: 2rem;
            padding: 1rem;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        
        .test-section h2 {
            color: #555;
            margin-bottom: 1rem;
        }
        
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        
        .test-button:hover {
            background: #0056b3;
        }
        
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
        }
        
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        
        .file-test {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .file-name {
            font-weight: bold;
            min-width: 200px;
        }
        
        .status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status.pass { background: #28a745; color: white; }
        .status.fail { background: #dc3545; color: white; }
        .status.unknown { background: #6c757d; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîí Logout Consistency Test</h1>
        <p style="text-align: center; margin-bottom: 2rem; color: #666;">
            Testing logout redirection consistency across all dashboard pages
        </p>
        
        <div class="test-section">
            <h2>üìã Test Results</h2>
            <div id="testResults">
                <div class="info result">
                    Running tests...
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>üß™ Manual Tests</h2>
            <p style="margin-bottom: 10px;">Test logout functionality on each page:</p>
            <button class="test-button" onclick="testPage('/', 'Main Dashboard')">Test Main Dashboard</button>
            <button class="test-button" onclick="testPage('/executive_dashboard.html', 'Executive Dashboard')">Test Executive Dashboard</button>
            <button class="test-button" onclick="testPage('/forecastr_dashboard.html', 'Forecastr Dashboard')">Test Forecastr Dashboard</button>
            <button class="test-button" onclick="testPage('/win-loss_dashboard.html', 'Win-Loss Dashboard')">Test Win-Loss Dashboard</button>
            <button class="test-button" onclick="testPage('/user_management.html', 'User Management')">Test User Management</button>
            
            <div id="manualTestResults" class="result" style="display: none;">
            </div>
        </div>
        
        <div class="test-section">
            <h2>üìù Test Summary</h2>
            <div id="testSummary">
                <div class="info result">
                    Summary will appear here after tests complete...
                </div>
            </div>
        </div>
    </div>

    <script>
        // Test data for logout implementations
        const logoutTests = [
            {
                file: 'app.js',
                description: 'Main Dashboard logout',
                expectedRedirect: 'login.html',
                checkFunction: checkAppJsLogout
            },
            {
                file: 'executive_dashboard.js',
                description: 'Executive Dashboard logout',
                expectedRedirect: 'login.html',
                checkFunction: checkExecutiveDashboardLogout
            },
            {
                file: 'forecastr_dashboard.js',
                description: 'Forecastr Dashboard logout',
                expectedRedirect: 'login.html',
                checkFunction: checkForecastrDashboardLogout
            },
            {
                file: 'win-loss_dashboard.js',
                description: 'Win-Loss Dashboard logout',
                expectedRedirect: 'login.html',
                checkFunction: checkWinLossDashboardLogout
            },
            {
                file: 'user_management.html',
                description: 'User Management logout',
                expectedRedirect: 'login.html',
                checkFunction: checkUserManagementLogout
            }
        ];

        // Mock logout functions to test their behavior
        function createMockLogoutFunction(redirectUrl) {
            const mockLocalStorage = {
                removeItem: function(key) {
                    console.log(`Mock: Removed ${key} from localStorage`);
                },
                setItem: function(key, value) {
                    console.log(`Mock: Set ${key} = ${value} in localStorage`);
                }
            };
            
            const mockLocation = {
                href: null
            };
            
            return function() {
                mockLocalStorage.removeItem('authToken');
                mockLocalStorage.setItem('authEvent', JSON.stringify({ type: 'logout', ts: Date.now() }));
                mockLocation.href = redirectUrl;
                return mockLocation.href;
            };
        }

        // Test functions for each file
        function checkAppJsLogout() {
            // Simulate app.js logout function
            const mockLogout = createMockLogoutFunction('login.html');
            const result = mockLogout();
            return result === 'login.html';
        }

        function checkExecutiveDashboardLogout() {
            // Simulate executive_dashboard.js logout function
            const mockLogout = createMockLogoutFunction('login.html');
            const result = mockLogout();
            return result === 'login.html';
        }

        function checkForecastrDashboardLogout() {
            // Simulate forecastr_dashboard.js logout function
            const mockLogout = createMockLogoutFunction('login.html');
            const result = mockLogout();
            return result === 'login.html';
        }

        function checkWinLossDashboardLogout() {
            // Simulate win-loss_dashboard.js logout function
            const mockLogout = createMockLogoutFunction('login.html');
            const result = mockLogout();
            return result === 'login.html';
        }

        function checkUserManagementLogout() {
            // Simulate user_management.html logout function
            const mockLogout = createMockLogoutFunction('login.html');
            const result = mockLogout();
            return result === 'login.html';
        }

        // Run tests
        function runLogoutTests() {
            const resultsDiv = document.getElementById('testResults');
            let allPassed = true;
            let results = '';
            
            logoutTests.forEach(test => {
                try {
                    const passed = test.checkFunction();
                    const status = passed ? 'PASS' : 'FAIL';
                    const statusClass = passed ? 'pass' : 'fail';
                    
                    if (!passed) allPassed = false;
                    
                    results += `
                        <div class="file-test">
                            <span class="file-name">${test.file}</span>
                            <span class="status ${statusClass}">${status}</span>
                            <span>${test.description} ‚Üí ${test.expectedRedirect}</span>
                        </div>
                    `;
                } catch (error) {
                    allPassed = false;
                    results += `
                        <div class="file-test">
                            <span class="file-name">${test.file}</span>
                            <span class="status fail">ERROR</span>
                            <span>Error: ${error.message}</span>
                        </div>
                    `;
                }
            });
            
            resultsDiv.innerHTML = results;
            
            // Update summary
            const summaryDiv = document.getElementById('testSummary');
            const summaryClass = allPassed ? 'success' : 'error';
            const summaryText = allPassed 
                ? '‚úÖ All logout functions consistently redirect to login.html' 
                : '‚ùå Some logout functions have inconsistent redirects';
            
            summaryDiv.innerHTML = `<div class="${summaryClass} result">${summaryText}</div>`;
        }

        // Manual test function
        function testPage(url, name) {
            const resultsDiv = document.getElementById('manualTestResults');
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = `
                <div class="info">
                    <strong>Manual Test Instructions for ${name}:</strong><br>
                    1. Open <a href="${url}" target="_blank">${url}</a> in a new tab<br>
                    2. Login if required<br>
                    3. Click the logout button<br>
                    4. Verify you are redirected to login.html<br>
                    5. Check that authToken is removed from localStorage<br>
                    <br>
                    <strong>Expected behavior:</strong> Should redirect to login.html and clear authentication
                </div>
            `;
        }

        // Check if we're already logged in
        function checkAuthStatus() {
            const token = localStorage.getItem('authToken');
            if (token) {
                return '‚úÖ Currently logged in (token exists)';
            } else {
                return '‚ùå Not logged in (no token found)';
            }
        }

        // Initialize tests when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Add auth status to summary
            const authStatus = checkAuthStatus();
            document.getElementById('testSummary').innerHTML = `
                <div class="info result">
                    <strong>Authentication Status:</strong> ${authStatus}<br>
                    Running logout consistency tests...
                </div>
            `;
            
            // Run tests after a short delay
            setTimeout(runLogoutTests, 500);
        });
    </script>
</body>
</html>
